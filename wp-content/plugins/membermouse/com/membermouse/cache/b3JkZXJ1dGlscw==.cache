/**
 * 
 * MemberMouse(TM) (http://www.membermouse.com)
 * (c) MemberMouse, LLC. All rights reserved.
 */
class MM_OrderUtils
{	
	/**
	 * This method takes an $order object and determines the rebill total and discount by iterating
	 * over the order items.
	 * 
	 * @param MM_Order $order the order to calculate rebill amounts for
	 * @return array an array containing the rebill total and discount amounts
	 */
	public static function getRebillAmounts(MM_Order $order)
	{
		$data = array();
		$data["rebill_total"] = 0;
		$data["rebill_shipping"] = 0;
		$data["rebill_subtotal"] = 0;
		$data["rebill_discount"] = 0;
		
		if($order->isValid())
		{
			$orderItems = $order->getProducts();
			$rebillOrderTotal = 0;
			$rebillDiscount = 0;
			
			foreach($orderItems as $orderItem)
			{
				$product = new MM_Product($orderItem->getItemId());
					
				if($product->isValid())
				{
					$data["rebill_total"] += $orderItem->getRecurringAmount();
					
					if(!is_null($orderItem->getRecurringDiscount()))
					{
						$data["rebill_subtotal"] += floatval($orderItem->getRecurringAmount()) + floatval($orderItem->getRecurringDiscount());
						$data["rebill_discount"] += $orderItem->getRecurringDiscount();
					}
					else 
					{
						$data["rebill_subtotal"] += $product->getPrice(false);
						
						// check if the price is discounted
						if($product->getPrice(false) > $orderItem->getRecurringAmount())
						{
							$data["rebill_discount"] += floatval($product->getPrice(false)) - floatval($orderItem->getRecurringAmount());
						}
					}
				}
			}
		}
		
		return $data;
	}
}
